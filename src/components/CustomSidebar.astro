---
// Custom sidebar that shows/hides content based on user role
---

<div id="custom-sidebar" class="sidebar-content">
  <!-- Default sidebar content - will be replaced by JavaScript -->
  <div class="sidebar-section">
    <h3>Welcome</h3>
    <ul>
      <li><a href="/wiki/">Getting Started</a></li>
      <li><a href="/wiki/contributing/">How to Contribute</a></li>
    </ul>
  </div>

  <div class="sidebar-section">
    <h3>Public Resources</h3>
    <ul>
      <li><a href="/wiki/">Wiki Home</a></li>
    </ul>
  </div>

  <!-- Working Group content - hidden by default -->
  <div id="working-group-section" class="sidebar-section" style="display: none;">
    <h3>üéØ AI Builders Circle</h3>
    <ul>
      <li><a href="/wiki/working-group/ai-builders-circle/">Circle Home</a></li>
      <li><a href="/wiki/working-group/ai-builders-circle/getting-started/">Getting Started</a></li>
      <li><a href="/wiki/working-group/ai-builders-circle/core-values/">Core Values</a></li>
      <li><a href="/wiki/working-group/ai-builders-circle/foundry-os/">Foundry OS</a></li>
      
      <li class="sidebar-submenu">
        <details>
          <summary>Challenges</summary>
          <ul>
            <li><a href="/wiki/working-group/ai-builders-circle/challenges/overview/">Overview</a></li>
            <li><a href="/wiki/working-group/ai-builders-circle/challenges/Challenges_list/">All Challenges</a></li>
            <li><a href="/wiki/working-group/ai-builders-circle/challenges/challenge_template/">Challenge Template</a></li>
          </ul>
        </details>
      </li>

      <li class="sidebar-submenu">
        <details>
          <summary>Events & Meetings</summary>
          <ul>
            <li><a href="/wiki/working-group/ai-builders-circle/Events/Events_overview/">Events Overview</a></li>
            <li><a href="/wiki/working-group/ai-builders-circle/Events/Events_list/">Events List</a></li>
            <li><a href="/wiki/working-group/ai-builders-circle/meetings/overview/">Meetings</a></li>
          </ul>
        </details>
      </li>

      <li class="sidebar-submenu">
        <details>
          <summary>Exploration</summary>
          <ul>
            <li><a href="/wiki/working-group/ai-builders-circle/exploration/RuV/RuV-SynapticMesh-explanation/">RuV SynapticMesh</a></li>
            <li><a href="/wiki/working-group/ai-builders-circle/exploration/RuV/swarm/Learning_swarming_example/">Swarm Learning</a></li>
          </ul>
        </details>
      </li>
    </ul>
  </div>

  <!-- Management content - hidden by default -->
  <div id="management-section" class="sidebar-section" style="display: none;">
    <h3>üè¢ Management Dashboard</h3>
    <ul>
      <li><a href="/wiki/management/">Dashboard</a></li>
      <li><a href="/wiki/working-group/ai-builders-circle/Circle_Management/management_tasks/">Circle Management</a></li>
      <li><a href="/wiki/working-group/ai-builders-circle/Circle_Management/member_table/">Member Directory</a></li>
    </ul>
  </div>
</div>

<script>
  // Function to update sidebar based on user role
  async function updateSidebarForUser() {
    try {
      const response = await fetch('/api/auth/user');
      if (response.ok) {
        const userData = await response.json();
        if (userData.userId) {
          const userRole = userData.role || 'public';
          
          // Show working group content for working_group and management users
          if (userRole === 'working_group' || userRole === 'management') {
            const workingGroupSection = document.getElementById('working-group-section');
            if (workingGroupSection) {
              workingGroupSection.style.display = 'block';
            }
          }
          
          // Show management content only for management users
          if (userRole === 'management') {
            const managementSection = document.getElementById('management-section');
            if (managementSection) {
              managementSection.style.display = 'block';
            }
          }
        }
      }
    } catch (error) {
      console.log('Could not fetch user data for sidebar:', error);
      // Keep default state (public only)
    }
  }

  // Update sidebar when page loads
  document.addEventListener('DOMContentLoaded', updateSidebarForUser);
  
  // Also update when authentication state changes
  window.addEventListener('load', updateSidebarForUser);
</script>

<style>
  .sidebar-content {
    padding: 1rem;
  }

  .sidebar-section {
    margin-bottom: 1.5rem;
  }

  .sidebar-section h3 {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--sl-color-gray-2);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .sidebar-section ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar-section li {
    margin-bottom: 0.25rem;
  }

  .sidebar-section a {
    color: var(--sl-color-gray-3);
    text-decoration: none;
    font-size: 0.875rem;
    padding: 0.25rem 0;
    display: block;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .sidebar-section a:hover {
    color: var(--sl-color-white);
    background-color: var(--sl-color-gray-6);
    padding-left: 0.5rem;
  }

  .sidebar-submenu details {
    margin: 0.25rem 0;
  }

  .sidebar-submenu summary {
    cursor: pointer;
    font-size: 0.875rem;
    color: var(--sl-color-gray-3);
    padding: 0.25rem 0;
    transition: color 0.2s ease;
  }

  .sidebar-submenu summary:hover {
    color: var(--sl-color-white);
  }

  .sidebar-submenu ul {
    margin-left: 1rem;
    margin-top: 0.5rem;
  }

  .sidebar-submenu ul a {
    font-size: 0.8rem;
    color: var(--sl-color-gray-4);
  }
</style>